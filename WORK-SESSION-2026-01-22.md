# Work Session - January 22, 2026

## Carryover from Jan 21

### Completed Today (Jan 21)

| Item | Status | Notes |
|------|--------|-------|
| App Icon Update | **DONE** | versionCode 28 (Android), buildNumber 13 (iOS) - thick stroke, no fill |
| iOS App Submission | **DONE** | Submitted to App Store Connect, processing |
| Android App Build | **DONE** | versionCode 28 with correct icon |

### Pending Items

| Item | Priority | Notes |
|------|----------|-------|
| Verify iOS icon in TestFlight | High | Check after Apple processing completes |
| Dirty Boxing DBX5 event | Medium | Not showing in app |
| Verify upcoming/completed fights accuracy | Medium | Partial testing done Jan 21 |

---

## App Icon Update Process (Reference)

Successfully changed app icon from "filled glove" to "thick stroke, no fill" version.

### Key Learnings

1. **Multiple cache layers** - Changing app.json is NOT enough. Must clear:
   - `.expo/` folder
   - `dist/` folder
   - Native `android/app/src/main/res/mipmap-*/` files (regenerated by prebuild)

2. **Two files for versionCode** - Android requires updating BOTH:
   - `packages/mobile/app.json` (line ~56)
   - `packages/mobile/android/app/build.gradle` (line ~95)

3. **iOS buildNumber** - Only in `app.json` (line ~20)

4. **Android launcher caches aggressively** - Even after uninstall/reinstall, may need to:
   - Settings > Apps > [Launcher] > Storage > Clear Cache

### Commands Used

```bash
# Copy icon to both required locations
cp "GOOD-FIGHTS-ICON-HAND-THICKER-GREY-BG.png" "packages/mobile/assets/homescreen-icon.png"
cp "GOOD-FIGHTS-ICON-HAND-THICKER-GREY-BG.png" "packages/mobile/assets/adaptive-icon-foreground-new.png"

# Clear ALL caches and regenerate native files
cd packages/mobile && rm -rf .expo dist && npx expo prebuild --clean --platform android

# Build
eas build --platform android --profile production
eas build --platform ios --profile production --non-interactive

# Submit iOS
eas submit --platform ios --latest --non-interactive
```

### Icon Files Reference

Located in project root:
- `GOOD-FIGHTS-ICON-HAND-THICKER-GREY-BG.png` - thick stroke, NO fill (current)
- `GOOD-FIGHTS-ICON-HAND-THICKER-FINGER.png` - thick stroke, WITH dark fill

---

## Today's Goals

1. **Verify iOS icon in TestFlight** - Should be available after Apple processing
2. **Check Dirty Boxing DBX5 event** - Why isn't it showing?
3. **Continue upcoming/completed fights verification**

---

## Session Log

### 2026-01-22 - Session Start

#### New Tasks

1. **Prediction Method Options for Boxing Fights** ‚úÖ DONE
   - **Problem**: Submission shown as prediction option for boxing fights
   - **Solution**: Fighter model has `sport` field (MMA, BOXING, BARE_KNUCKLE_BOXING, MUAY_THAI, KICKBOXING)
   - **Changes made**:
     - Backend: Added `sport: true` to fighter select in fights.ts
     - Mobile: Added Sport type to Fighter interface
     - Mobile: Filter method options in UpcomingFightDetailScreen based on fighter1.sport
   - **Commit**: `3dc3f48` - Pushed to production, awaiting testing

2. **UFC 321, 322, 323 Appearing in "Upcoming Fights"** ‚úÖ FIXED
   - **Root cause**: Database had year **2026** instead of **2025** for these events
   - **Why it happened**: UFC dateText doesn't include year (e.g., "Sat, Oct 25"). When scraper ran in 2026, it assumed current year. The upsert then **overwrote** the correct dates.
   - **Data fix**: Ran script to correct dates:
     - UFC 321: 2026-10-25 ‚Üí **2025-10-25**, marked complete
     - UFC 322: 2026-11-16 ‚Üí **2025-11-15**, marked complete
     - UFC 323: 2026-12-07 ‚Üí **2025-12-06**, marked complete
   - **Code fix**: Updated `ufcDataParser.ts` to NOT overwrite dates for completed events
   - **Commit**: `c60834a` - Pushed to production

3. **Daily Scrapers Memory Issues on Render** ‚úÖ FIXED
   - **Root cause**: Render free tier has 512MB RAM, each Puppeteer scraper uses 300-400MB
   - **Solution**: Move all scrapers to GitHub Actions (7GB RAM, free, isolated runs)
   - **Existing workflows**: UFC, BKFC, Oktagon, Matchroom, Golden Boy (already working)
   - **New workflows created**:
     - `pfl-scraper.yml` - runs daily at 22:00 UTC (5pm EST)
     - `onefc-scraper.yml` - runs daily at 23:00 UTC (6pm EST)
     - `toprank-scraper.yml` - runs daily at 00:00 UTC (7pm EST)
   - **Full schedule** (all staggered 1 hour apart):
     | Scraper | UTC | EST |
     |---------|-----|-----|
     | UFC | 17:00 | 12pm |
     | Oktagon | 18:00 | 1pm |
     | BKFC | 19:00 | 2pm |
     | Matchroom | 20:00 | 3pm |
     | Golden Boy | 21:00 | 4pm |
     | PFL | 22:00 | 5pm |
     | ONE FC | 23:00 | 6pm |
     | Top Rank | 00:00 | 7pm |
   - **Commit**: `7778fed` - Pushed to main
   - **To test manually**: GitHub Actions ‚Üí select workflow ‚Üí "Run workflow"

4. **"Thicker" Icon Rollout Throughout App** üü° MOSTLY DONE
   - Homescreen icon updated (versionCode 28) ‚úÖ
   - **Updated files**:
     - `app-icon-internal.png` (header) ‚ö†Ô∏è NEEDS REBUILD - fixed to use transparent bg `520c324`
     - `login-logo.png` (login/signup screens) ‚úÖ `3de370d`
     - `splash-logo.png` ‚úÖ `c90393e`
     - `logo-v2.png` (backend emails) ‚úÖ `10d03ac` - Render deployed
     - Landing page logos ‚úÖ `9f94d1c` - Vercel deployed
       - `logo-full.png`, `icon.png`, `favicon.png`
     - Website verify/reset pages ‚úÖ `c3c6df2` - Fixed aspect ratio
   - **Builds completed**:
     - Android versionCode 29: https://expo.dev/artifacts/eas/P55sv9Se6ggQnEkxvTC4C.aab
     - iOS buildNumber 14: https://expo.dev/artifacts/eas/stGZV2c6HJKhjoEhzwEHNa.ipa
   - **Pending for next build**:
     - Header icon needs transparent bg version (committed `520c324`, needs versionCode 30)
     - App Store listing (manual upload)
     - Play Store listing (manual upload)

5. **Manual Verification of January Events** ‚ùå NOT STARTED
   - Check events/fights on upcoming fights screen for correctness
   - Fix any scraper/parser problems found

6. **Sport-Based Method Prediction Filtering** üü° NEEDS REDESIGN
   - **Problem**: Boxing fights (e.g., Walsh vs Ocampo) incorrectly show "Submission" as prediction option
   - **Current approach**: Uses `fighter1.sport` to determine available methods
   - **Why it's broken**:
     - Fighters change sports throughout careers (MMA ‚Üí Boxing ‚Üí MMA)
     - Fighter's "current" sport doesn't reflect the sport of a specific fight
     - Zuffa parser only sets `sport: BOXING` on CREATE, not UPDATE (so existing fighters keep old sport)
   - **Better approaches**:
     - **Option A (quick fix)**: Derive sport from `event.promotion` in frontend (no migration)
       - Map promotions ‚Üí sports: "Zuffa Boxing" ‚Üí BOXING, "UFC" ‚Üí MMA, etc.
     - **Option B (proper fix)**: Add `sport` field to Event model
       - Events are promotion-specific, all fights in an event share the sport
       - Requires schema migration + scraper updates
   - **Files involved**:
     - `packages/mobile/components/UpcomingFightDetailScreen.tsx` (lines 1515-1517)
     - `packages/backend/src/services/zuffaBoxingDataParser.ts` (line 205-210 missing sport in update)

#### Important Notes

- **ALL WORK IS ON PRODUCTION** - No local development
- **Build credits at 100%** - Now pay-as-you-go

---

## Important Rules

- **DO NOT start EAS builds without user confirmation** - Build credits at 100% (pay-as-you-go now)
- **Always use Render External URL** - Never local DB unless explicitly asked
- **Keep this document updated** as work progresses
